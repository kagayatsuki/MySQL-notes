# 触发器

触发器是一种数据库对象，绑定到某个表上，当表上发生特定事件（如INSERT、UPDATE、DELETE）时，触发器会自动执行定义的SQL语句。

它可以用来生成一些指定内容（比如日志）

MySQL触发器的创建语法如下：

```sql
CREATE TRIGGER 触发器名称
{BEFORE | AFTER} {INSERT | UPDATE | DELETE} --触发器执行的时机，BEFORE表示在事件发生前执行，AFTER表示在事件发生后执行。
--                                                触发器绑定的事件类型
ON 表名
FOR EACH ROW --表示触发器是行级触发器，即对每一行操作都会触发
[触发器顺序]
BEGIN
    -- 触发器执行的SQL语句
END;
```

查看触发器使用SHOW TRIGGERS，删除触发器使用DROP TRIGGER...  。

为了形象的表示，我们用一个例子来说明：

假设有一个users表，记录用户信息，我们希望在每次更新users表时，将旧数据记录到users_log表中。

表的结构如下：

```sql
-- 创建用户表
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100)
);
-- 创建日志表
CREATE TABLE users_log (
    log_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    old_email VARCHAR(100),
    change_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

我们可以创建如下触发器：

```sql
-- 创建触发器
DELIMITER //
CREATE TRIGGER after_users_update
AFTER UPDATE
ON users
FOR EACH ROW
BEGIN
    INSERT INTO users_log (user_id, old_email)
    VALUES (OLD.id, OLD.email);
END //
DELIMITER ;

-- 测试触发器
INSERT INTO users (username, email) VALUES ('Alice', 'alice@example.com');
UPDATE users SET email = 'alice_new@example.com' WHERE id = 1;
```

（DELIMITER //用于改变语句分隔符，以支持多行触发器定义。）

此时会输出：

```*
+--------+---------+-------------------+---------------------+
| log_id | user_id | old_email         | change_time         |
+--------+---------+-------------------+---------------------+
| 1      | 1       | alice@example.com | 2025-08-14 18:17:00 |
+--------+---------+-------------------+---------------------+
```
